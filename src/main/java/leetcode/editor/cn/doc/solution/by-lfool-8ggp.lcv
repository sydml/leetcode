# [å¦‚æœæƒ³è¦æŸ¥çœ‹ä½œè€…æ›´å¤šæ–‡ç« ï¼Œå¯ä»¥ç‚¹å‡»æ­¤å¤„ï¼ï¼ï¼ğŸ”¥ğŸ”¥ğŸ”¥](https://lfool.github.io/LFool-Notes/)

[46. å…¨æ’åˆ—](https://leetcode-cn.com/problems/permutations/)

[51. N çš‡å](https://leetcode-cn.com/problems/n-queens/)

å…¶å®åœ¨æœ¬ç¯‡æ–‡ç« ä¹‹å‰ï¼Œå·²ç»æœ‰è¿‡å…³äº DFS é¢˜å‹çš„æ€»ç»“ï¼š[æ’åˆ—/ç»„åˆ/å­é›† é—®é¢˜](https://lfool.github.io/LFool-Notes/algorithm/æ’åˆ—-ç»„åˆ-å­é›†é—®é¢˜.html) å’Œ [ç§’æ€æ‰€æœ‰å²›å±¿é¢˜ç›®(DFS)](https://lfool.github.io/LFool-Notes/algorithm/ç§’æ€æ‰€æœ‰å²›å±¿é¢˜ç›®(DFS).html)

ã€ŒDFS ç®—æ³•ã€å’Œã€Œå›æº¯ç®—æ³•ã€å…¶å®æ˜¯åŒä¸€ä¸ªæ¦‚å¿µï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ç§æš´åŠ›ç©·ä¸¾ç®—æ³•

å›æº¯ç®—æ³•å…¶å®å°±æ˜¯åœ¨æ ‘çš„éå†è¿‡ç¨‹ä¸­å¢åŠ äº†ã€Œå†³ç­–ã€ã€‚å…³äºå¯¹æ ‘çš„éå†çš„è¯¦ç»†ç†è§£ï¼Œå¯ä»¥å‚è€ƒ [äºŒå‰æ ‘--çº²é¢†ç¯‡](https://lfool.github.io/LFool-Notes/algorithm/äºŒå‰æ ‘--çº²é¢†ç¯‡.html) ä¸­çš„ç›¸å…³éƒ¨åˆ†

## æ¡†æ¶çš„æå‡º

ä¸‹é¢æˆ‘ä»¬æ¥è¯´ç‚¹ DFS ç®—æ³•çš„æ ¸å¿ƒå†…å®¹ã€‚æˆ‘ä»¬å…ˆä»¥æ ‘ä¸ºå‰æï¼Œä¾¿äºç†è§£

å½“æˆ‘ä»¬ç«™åœ¨å›æº¯æ ‘çš„ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä½ åªéœ€è¦æ€è€ƒ 3 ä¸ªé—®é¢˜ï¼š

- **è·¯å¾„**ï¼šå·²ç»åšå‡ºçš„é€‰æ‹©

- **é€‰æ‹©åˆ—è¡¨**ï¼šå½“å‰å¯ä»¥åšçš„é€‰æ‹©

- **ç»“æŸæ¡ä»¶**ï¼šåˆ°è¾¾å†³ç­–æ ‘åº•å±‚ï¼Œæ— æ³•å†åšé€‰æ‹©çš„æ¡ä»¶

åŸºäºä¸Šè¿°ä¸‰ä¸ªé—®é¢˜ï¼Œç»™å‡ºç›¸å¯¹åº”çš„ä¼ªä»£ç ï¼š

* java

```java
result = []
def backtrack(è·¯å¾„, é€‰æ‹©åˆ—è¡¨):
    if æ»¡è¶³ç»“æŸæ¡ä»¶:
        result.add(è·¯å¾„)
        return
    
    for é€‰æ‹© in é€‰æ‹©åˆ—è¡¨:
        åšé€‰æ‹©
        backtrack(è·¯å¾„, é€‰æ‹©åˆ—è¡¨)
        æ’¤é”€é€‰æ‹©
```

## å…¨æ’åˆ—é—®é¢˜

å¯¹äºå…¨æ’åˆ—é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æŠ½è±¡æˆä¸€é¢—ä¸‰å‰æ ‘ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![1543351649058215WwQMHi3.svg](https://pic.leetcode-cn.com/1650343238-Gndjbj-1543351649058215WwQMHi3.svg)

æˆ‘ä»¬ç°åœ¨éœ€è¦å¾—åˆ°æ‰€æœ‰çš„å…¨æ’åˆ—ç»„åˆï¼Œæ— éå°±æ˜¯å¾—åˆ°æ‰€æœ‰ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯å¾„ï¼

**é—®é¢˜ä¸€**ï¼šç”±äºè¿™æ˜¯ä¸€é¢—æŠ½è±¡å‡ºæ¥çš„æ ‘ï¼Œå¶å­èŠ‚ç‚¹å¹¶æ²¡æœ‰å’Œæ ‘ä¸€æ ·çš„ç‰¹å¾ï¼Œå¦‚ä½•åˆ¤æ–­åˆ°è¾¾äº†å¶å­èŠ‚ç‚¹ï¼Ÿï¼Ÿ

**å›ç­”ä¸€**ï¼šæ ¹æ®è·¯å¾„çš„é•¿åº¦åˆ¤æ–­æ˜¯å¦ç»“æŸï¼ï¼

ä¸‹é¢æˆ‘ä»¬å…ˆä¸è€ƒè™‘å…¶ä»–çš„æƒ…å†µï¼ŒæŠŠæ‰€æœ‰çš„è·¯å¾„éå†å‡ºæ¥ï¼Œä»£ç å¦‚ä¸‹ï¼š

* java

```java
int[] nums = {1, 2, 3};
List<Integer> path = new ArrayList<>();
List<List<Integer>> result = new ArrayList<>();
public void backtrack(int[] nums) {
    // åˆ¤æ–­ï¼šç»“æŸæ¡ä»¶
    if (path.size() == nums.length) {
        result.add(new ArrayList<>(path));
        return ;
    }
    for (int i = 0; i < nums.length; i++) {
        // å…ˆåºï¼šé¦–æ¬¡è¿›å…¥èŠ‚ç‚¹ï¼Œæ·»åŠ åˆ°ã€Œè·¯å¾„ã€ä¸­
        path.add(nums[i]);
        // é€’å½’
        backtrack(nums);
        // åç»­ï¼šå³å°†ç¦»å¼€èŠ‚ç‚¹ï¼Œä»ã€Œè·¯å¾„ã€ä¸­é™¤å»
        path.remove(path.size() - 1);
    }
}
```

æœ€åè¿è¡Œçš„ç»“æœï¼š

* 

```
27
[[1, 1, 1], [1, 1, 2], [1, 1, 3], [1, 2, 1], [1, 2, 2], [1, 2, 3], [1, 3, 1], [1, 3, 2], [1, 3, 3], 
 [2, 1, 1], [2, 1, 2], [2, 1, 3], [2, 2, 1], [2, 2, 2], [2, 2, 3], [2, 3, 1], [2, 3, 2], [2, 3, 3], 
 [3, 1, 1], [3, 1, 2], [3, 1, 3], [3, 2, 1], [3, 2, 2], [3, 2, 3], [3, 3, 1], [3, 3, 2], [3, 3, 3]]
```

**é—®é¢˜äºŒ**ï¼šå¯¹äºä¸Šè¿°ç»“æœï¼Œå­˜åœ¨å…ƒç´ é‡å¤ä½¿ç”¨çš„æƒ…å†µï¼Œå¦‚ä½•é¿å…è¿™ç§æƒ…å†µå‘¢ï¼Ÿï¼Ÿ

**å›ç­”äºŒ**ï¼šæ–°å¢ä¸€ä¸ª`used[]`æ•°ç»„ï¼Œè®°å½•å…ƒç´ ä½¿ç”¨æƒ…å†µï¼ï¼

ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼š

* java

```java
int[] nums = {1, 2, 3};
boolean[] used[] = new boolean[nums.length];
List<Integer> path = new ArrayList<>();
List<List<Integer>> result = new ArrayList<>();
public void backtrack(int[] nums) {
    // åˆ¤æ–­ï¼šç»“æŸæ¡ä»¶
    if (path.size() == nums.length) {
        result.add(new ArrayList<>(path));
        return ;
    }
    for (int i = 0; i < nums.length; i++) {
        // å¦‚æœä½¿ç”¨è¿‡äº†ï¼Œåˆ™ç›´æ¥è·³è¿‡
        if (used[i]) continue;
        // å…ˆåºï¼šé¦–æ¬¡è¿›å…¥èŠ‚ç‚¹ï¼Œæ·»åŠ åˆ°ã€Œè·¯å¾„ã€ä¸­
        path.add(nums[i]);
        // æ ‡è®°ä½¿ç”¨
        used[i] = true;
        // é€’å½’
        backtrack(nums);
        // åç»­ï¼šå³å°†ç¦»å¼€èŠ‚ç‚¹ï¼Œä»ã€Œè·¯å¾„ã€ä¸­é™¤å»
        path.remove(path.size() - 1);
        // å–æ¶ˆæ ‡è®°
        used[i] = false;
    }
}
```

æœ€åè¿è¡Œç»“æœå¦‚ä¸‹ï¼š

* 

```
6
[[1, 2, 3], [1, 3, 2], [2, 1, 3], [2, 3, 1], [3, 1, 2], [3, 2, 1]]
```

## N çš‡åé—®é¢˜

é¦–å…ˆæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ã€‚å¯¹äºæ¯ä¸€è¡Œï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ n ä¸ªé€‰æ‹©ï¼Œå³ä»»é€‰ä¸€ä¸ªæ ¼æ”¾ä¸‹æ£‹å­ï¼Œåªè¦æ»¡è¶³è¦æ±‚å³å¯ï¼›åŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦åš n æ¬¡è¿™æ ·çš„é€‰æ‹©ï¼Œå³å­˜åœ¨ n è¡Œï¼Œæ¯ä¸€è¡Œé€‰æ‹©ä¸€ä¸ªæ ¼å­æ”¾æ£‹å­

N çš‡åçš„å†³ç­–æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![3.svg](https://pic.leetcode-cn.com/1650343271-KtQrRO-3.svg)

å¾ˆä¸å·§çš„æ˜¯ï¼Œn = 3 æ—¶ï¼Œæ²¡æœ‰ä¸€ç§æƒ…å†µæ—¶ç¬¦åˆçš„ã€‚ä¸è¿‡è¿™ä¸é‡è¦ï¼ï¼ï¼

**é—®é¢˜ä¸€**ï¼šç”¨ä»€ä¹ˆæ•°æ®æ¥è¡¨ç¤ºæ£‹ç›˜å‘¢ï¼Ÿï¼Ÿï¼Ÿ

**å›ç­”ä¸€**ï¼šäºŒç»´æ•°ç»„ã€‚`.`è¡¨ç¤ºæœªæ”¾æ£‹å­ï¼›`Q`è¡¨ç¤ºæ”¾äº†æ£‹å­

**é—®é¢˜äºŒ**ï¼šå¦‚ä½•åˆ¤æ–­å½“å‰è¡ŒæŸä¸€æ ¼æ”¾ä¸‹æ£‹å­æ˜¯æ»¡è¶³è¦æ±‚çš„å‘¢ï¼Ÿï¼Ÿ

**å›ç­”äºŒ**ï¼šå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

* java

```java
private boolean isValid(char[][] board, int row, int col) {
    int n = board.length;
    // æ£€æŸ¥åˆ—æ˜¯å¦æœ‰å†²çª
    for (int i = 0; i < n; i++) {
        if (board[i][col] == 'Q') return false;
    }
    // æ£€æŸ¥å³ä¸Šæ–¹æ˜¯å¦æœ‰å†²çª
    for (int i = row - 1, j = col + 1; i >= 0 && j < n; i--, j++) {
        if (board[i][j] == 'Q') return false;
    }
    // æ£€æŸ¥å·¦ä¸Šæ–¹æ˜¯å¦æœ‰å†²çª
    for (int i = row - 1, j = col - 1; i >= 0 && j >= 0; i--, j--) {
        if (board[i][j] == 'Q') return false;
    }
    return true;
}
```

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥å®ç°æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

* java

```java
private List<String> list;
private List<List<String>> result;
public List<List<String>> solveNQueens(int n) {
    this.n = n;
    list = new ArrayList<>();
    result = new ArrayList<>();
    char[][] board = new char[n][n];
    // åˆå§‹åŒ–æ£‹ç›˜
    for (int i = 0; i < n; i++) {
        Arrays.fill(board[i], '.');
    }
    // ä»ç¬¬ 0 è¡Œå¼€å§‹
    backtrack(board, 0);
    return result;
}
private void backtrack(char[][] board, int row) {
    // æ»¡è¶³è¦æ±‚
    if (list.size() == board.length) {
        result = new ArrayList<>(list);
        return ;
    }
    for (int i = 0; i < board.length; i++) {
        // è¯¥æ ¼ä¸ç¬¦åˆæ”¾æ£‹å­çš„æ¡ä»¶
        if (!isValid(board, row, i)) continue;
        // æ”¾æ£‹å­
        board[row][i] = 'Q';
        // è®°å½•å½“å‰è¡Œçš„æ•°æ®
        list.add(new String(board[row]));
        
        // å¤„ç†ä¸‹ä¸€è¡Œ
        backtrack(board, row + 1);
        
        // ç§»é™¤æ£‹å­
        board[row][i] = '.';
        // å»é™¤å½“å‰è¡Œçš„æ•°æ®
        list.remove(list.size() - 1);
    }
}
```

## å²›å±¿é—®é¢˜

å…³äºå²›å±¿ç›¸å…³çš„é—®é¢˜ï¼Œå¯ä»¥å» [ä¼ é€é—¨](https://lfool.github.io/LFool-Notes/algorithm/%E7%A7%92%E6%9D%80%E6%89%80%E6%9C%89%E5%B2%9B%E5%B1%BF%E9%A2%98%E7%9B%AE\(DFS\).html) è¯¦ç»†æŸ¥çœ‹

å²›å±¿é—®é¢˜æ˜¯ä¸€ä¸ªå›¾çš„é—®é¢˜ï¼Œæœ¬è´¨ä¹Ÿæ˜¯ä½¿ç”¨ DFS ç®—æ³•ã€‚åœ¨è¿™é‡Œåªç®€å•çš„è§£é‡Šä¸€ä¸‹æ˜¯å¦‚ä½•å¥—ç”¨æˆ‘ä»¬çš„æ¨¡ç‰ˆæ»´æ»´æ»´ï¼ï¼

è¿™é‡ŒæŠŠå²›å±¿çš„æ¨¡ç‰ˆ copy è¿‡æ¥äº†ï¼ï¼å¦‚ä¸‹æ‰€ç¤ºï¼š

* java

```java
// é€’å½’ï¼šã€Œå½“å‰èŠ‚ç‚¹ã€ã€Œè¯¥åšä»€ä¹ˆã€ã€Œä»€ä¹ˆæ—¶å€™åšã€
// FloodFillï¼šå¦‚æœå½“å‰ä½ç½®æ˜¯å²›å±¿ï¼Œåˆ™å¡«å……ä¸ºæµ·æ°´
//   - å……å½“äº† visited[] çš„ä½œç”¨
private void dfs(int[][] grid, int i, int j) {
    int m = grid.length;
    int n = grid[0].length;
    // è¶Šç•Œæ£€æŸ¥
    if (i < 0 || i >= m || j < 0 || j >= n) return ;
    // å¦‚æœæ˜¯æµ·æ°´
    if (grid[i][j] == 0) return ;
    // å¦åˆ™ï¼š1 -> 0
    grid[i][j] = 0;
    // é€’å½’å¤„ç†ä¸Šä¸‹å·¦å³
    dfs(grid, i - 1, j); // ä¸Š
    dfs(grid, i + 1, j); // ä¸‹
    dfs(grid, i, j - 1); // å·¦
    dfs(grid, i, j + 1); // å³
}
```

æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªæ¡†æ¶çš„ç»“æ„ï¼Œçœ‹æ˜¯å¦ä¸æœ¬æ–‡æœ€å¼€å§‹ç»™å‡ºçš„æ¡†æ¶ä¿æŒä¸€è‡´

é¦–å…ˆæ¥çœ‹ä¸‹é¢ä¸¤è¡Œä»£ç ï¼š

* java

```java
// è¶Šç•Œæ£€æŸ¥
if (i < 0 || i >= m || j < 0 || j >= n) return ;
// å¦‚æœæ˜¯æµ·æ°´
if (grid[i][j] == 0) return ;
```

è¿™ä¸¤è¡Œä»£ç å®è´¨æ˜¯ç»™å‡ºäº†ç»“æŸé€’å½’çš„ base caseã€‚ç±»ä¼¼äºã€Œæ»¡è¶³ç»“æŸæ¡ä»¶ã€æ—¶ï¼Œä¿å­˜ç»“æœï¼Œå¹¶è¿”å›

* java

```java
grid[i][j] = 0;
```

è¿™ä¸€è¡Œä»£ç æ˜¯å¤„ç†å½“å‰èŠ‚ç‚¹çš„é€»è¾‘ä»£ç 

* java

```java
dfs(grid, i - 1, j); // ä¸Š
dfs(grid, i + 1, j); // ä¸‹
dfs(grid, i, j - 1); // å·¦
dfs(grid, i, j + 1); // å³
```

è¿™å››è¡Œä»£ç è¡¨ç¤ºå¯ä»¥ä» 4 ä¸ªæ–¹å‘è¿›è¡Œé€’å½’æœç´¢

è‡³äºè¿™é‡Œä¸ºä»€ä¹ˆæ²¡æœ‰æœ€åçš„æ’¤é”€æ“ä½œï¼ŸåŸå› æ˜¯æˆ‘ä»¬éœ€è¦ä¿å­˜ä¿®æ”¹åçš„æ•°æ®ï¼Œåœ¨åç»­éœ€è¦ç”¨åˆ°çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦æ’¤é”€ï¼ï¼
